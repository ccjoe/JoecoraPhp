function XMLHttpData(){function loadXMLDoc(a){xmlhttp=null,window.XMLHttpRequest?xmlhttp=new XMLHttpRequest:window.ActiveXObject&&(xmlhttp=new ActiveXObject("Microsoft.XMLHTTP")),null!=xmlhttp?(xmlhttp.onreadystatechange=getXMLHttpData,xmlhttp.open("get",a,!0),xmlhttp.send(null)):alert("您的浏览器不支持 XMLHTTP")}function getXMLHttpData(){4===xmlhttp.readyState&&(0===xmlhttp.status||200===xmlhttp.status?(song=eval("("+xmlhttp.responseText+")"),formatPlayer(song)):alert("XMLHTTP error，请刷新浏览器"))}var xmlhttp,song;loadXMLDoc("/wp-content/themes/twentyfourteen/public/data/songData.json")}function formatPlayer(a){var b=new MUSICENGINE(a),c=document.getElementById("musicEngine"),d=document.getElementById("musicPlayerSwitch"),e=document.getElementById("play"),f=document.getElementById("pause"),g=document.getElementById("next"),h=document.getElementById("prev"),i=document.getElementById("nowVolume"),j=document.getElementById("nowMute"),k=document.getElementById("volume"),l=document.getElementById("mute"),m=document.getElementById("volumeSizeBg"),n=document.getElementById("progressRateBg"),o=document.getElementById("lyrics"),p=document.getElementById("albumLists");setTimeout(function(){b.toPlay("play")},3e4),e.onclick=function(){b.toPlay("play")},f.onclick=function(){b.toPlay("pause")},g.onclick=function(){""!=c.src&&b.next()},h.onclick=function(){""!=c.src&&b.prev()},i.onclick=function(){b.volume("on")},j.onclick=function(){b.volume("off")},k.onclick=function(){b.volume("on")},l.onclick=function(){b.volume("off")},m.onclick=function(a){var c=VolumeChangeProcess(a);b.volumeControlStrip(c)},n.onclick=function(a){if(""==c.src)return!1;var d=getSongProgress(a);b.songProgressAdjust(d)},p.onclick=function(){b.albumLists()},document.getElementsByTagName("body")[0].onclick=function(a){var c=a?a:window.event;if("closeList"===c.target.id)return closeList(),!1;if("cutoverList"===c.target.id){if("返回"===c.target.innerHTML)return document.getElementById("albumLists").click(),document.getElementById("albumLists").click(),b.formatAlbumLists(),!1;if("专辑列表"===c.target.innerHTML)return document.getElementById("albumLists").click(),b.formatAlbumLists(),!1;if("查看全部歌曲"===c.target.innerHTML)return b.formatAllSongLists(),!1}if(c.target.parentNode&&"s-l"===c.target.parentNode.className){var d=b.muiscIndexAndAlbumIndex(c.target.parentNode);return b.playIndex(d.albumIndex,d.songIndex),currentlyPlayingSong(),!1}return"play-btn"===c.target.className?(c.target.parentNode.parentNode.ondblclick(),document.getElementById("listWrap").childNodes[0].childNodes[0].click(),!1):"play-icon"===c.target.className?(c.target.parentNode.parentNode.parentNode.ondblclick(),document.getElementById("listWrap").childNodes[0].childNodes[0].click(),!1):void 0},o.onclick=function(){lrcBoxSwitch()},p.click(),o.click(),d.click()}function MUSICENGINE(a){var b=document.createElement("audio");b.id="musicEngine",document.getElementById("musicPlayerWrap").appendChild(b),this.song=a,this.musicPlayer=document.getElementById("musicEngine"),this.musicPlayer.addEventListener("canplaythrough",function(){hide(document.getElementById("loadLrc"))})}function VolumeChangeProcess(a){var b,c,d=(document.getElementById("volumeSizeBg"),coordinate(a)),e=d.coord_Y;return b=progressBarPercentage(48,e),volumeSize(b),c=parseInt((100-b)/10)/10}function volumeIconSwitch(a){var b=document.getElementById("nowVolume"),c=document.getElementById("nowMute"),d=document.getElementById("volume"),e=document.getElementById("mute"),f=document.getElementById("volumeSizeColor");"on"===a&&(hide(b),show(c),hide(d),show(e),f.style.height="100%"),"off"===a&&(hide(c),show(b),hide(e),show(d))}function volumeSize(a){var b=document.getElementById("volumeSizeColor");b.style.height=a+"%"}function getSongProgress(a){var b,c,d=(document.getElementById("progressRateBg"),document.getElementById("musicEngine")),e=coordinate(a),f=e.coord_X;return songScheduleChange(f),b=progressBarPercentage(262,f)/100,c=b*d.duration}function songScheduleChange(a){var b=document.getElementById("progressRateColor");b.style.width=a+"px"}function timeAll(){var a=document.getElementById("musicEngine");return 0!=a.currentTime?a.duration:0}function currentTime(){var a=document.getElementById("musicEngine");return a.currentTime}function songPlaybackTime(a,b){var c,d,e=document.getElementById("playTime"),f=document.getElementById("surplusTime");a>b?(c=parseInt(b),d=parseInt(a-b),e.innerHTML=conversionTime(c),f.innerHTML="-"+conversionTime(d)):(e.innerHTML="0:00",f.innerHTML="-0:00")}function conversionTime(a){var b,c,d;return b=Math.floor(a/60%60),c=Math.floor(a%60),10>c&&(c="0"+c),d=b+":"+c}function formatInAlbumLists(a,b){for(var c,d=document.getElementById("listWrap"),e=document.getElementById("cutoverList"),f=a.songData.length,g="",h=0;f>h;h++)if(a.songData[h].albumName===b){c=a.songData[h].albumSong.length;for(var i=0;c>i;i++)g+='<li class="s-l">',g+='<span class="s-name" title="'+a.songData[h].albumSong[i].musicName+'">'+a.songData[h].albumSong[i].musicName+"</span>",g+='<span class="s-album" title="'+a.songData[h].albumName+'">'+a.songData[h].albumName+"</span>",g+='<span class="s-time">'+a.songData[h].albumSong[i].musicTime+"</span>",g+='<div name="addFavorites" class="add-favorites hidden" title="喜欢"></div>',g+="</li>"}d.className="list-wrap song",d.attributes["data-temp"].nodeValue="1",e.innerHTML="返回",e.className="cutover-list",d.innerHTML=g,currentlyPlayingSong()}function closeList(){var a=document.getElementById("musicList"),b=document.getElementById("albumLists"),c=document.getElementById("listWrap");addClass(a,"hidden"),removeClass(b,"album-lists-hover"),b.title="打开专辑列表",c.className="list-wrap"}function innerMusicList(){if(!document.getElementById("musicList")){var a=document.createElement("div");a.id="musicList",a.className="music-list hidden",document.getElementsByTagName("body")[0].appendChild(a);var b="";b+='<div class="list-title">',b+='<strong id="listName"></strong>',b+='<span id="cutoverList" class="cutover-list hidden"></span>',b+='<div id="closeList" class="close-list" title="关闭列表"></div>',b+="</div>",b+='<ul id="listWrap" class="list-wrap" data-temp=""></ul>',document.getElementById("musicList").innerHTML="",document.getElementById("musicList").innerHTML=b}}function currentlyPlayingSong(){for(var a=document.getElementById("listWrap"),b=document.getElementById("musicName").innerHTML,c=document.getElementById("albumName").innerHTML,d=0;d<a.childNodes.length;d++){for(var e=0;e<a.childNodes.length;e++)removeClass(a.childNodes[e],"playIng");if(hasClass(a,"song")&&a.childNodes[d].childNodes[0].innerHTML===b){addClass(a.childNodes[d],"playIng");break}if(hasClass(a,"album")&&a.childNodes[d].childNodes[1].childNodes[1].innerHTML===c){addClass(a.childNodes[d],"playIng");break}}}function PlayModeIconChange(a){var b,c=document.getElementById("nowPlayManner"),d=document.getElementById("playMannerControl"),e=a.className,f=a.title;c.className="now-manner "+e+" "+e+"-active",c.title=f,b=document.createElement("a"),b.href="javascript:void(0);",b.id=a.id,b.className=a.className,b.title=a.title,d.removeChild(a),d.appendChild(b),hide(d)}function playerInitialization(){var a=document.getElementById("albumFrontCover"),b=document.getElementById("musicName"),c=document.getElementById("musicSinger"),d=document.getElementById("albumName"),e=document.getElementById("playTime"),f=document.getElementById("surplusTime"),g=document.getElementById("progressRateColor"),h=document.getElementById("musicEngine");a.src="images/album.png",b.innerHTML="FeelPlayer",b.title="FeelPlayer",c.innerHTML="播放最爱的音乐",c.title="播放最爱的音乐",d.innerHTML="",d.title="",h.src="",e.innerHTML="0:00",f.innerHTML="-0:00",g.style.width="0",currentlyPlayingSong()}function lrcMove(a,b){for(var c,d,e,f=document.getElementById("lrcBox"),g=f.getElementsByTagName("p"),h=parseInt(f.style.marginTop.split("-")[1])||0,i=0;i<g.length;i++){var j=parseInt(g[i].attributes["data-timeLine"].nodeValue);if(j>0&&j===parseInt(b)&&(d=i,e!=i)){e=i;for(var k=0;k<g.length;k++)removeClass(g[k],"color");d>0&&addClass(g[d],"color"),clearInterval(c),c=setInterval(function(){h+=1,h>=30*d?clearInterval(c):f.style.marginTop="-"+h+"px"},10)}}}function lrcAtuoMove(a){for(var b,c,d=document.getElementById("lrcBox"),e=d.getElementsByTagName("p"),f=parseInt(a),g=[],h=0;h<e.length;h++)g.push(e[h].attributes["data-timeLine"].nodeValue);for(var i=0;i<g.length;i++)if(g[i]>f){b=g[i-1];break}c=b?g.indexOf(b):e.length-1,d.style.marginTop="-"+30*parseInt(c)+"px";for(var j=0;j<e.length;j++)removeClass(e[j],"color");c>0&&addClass(e[c],"color")}function progressBarPercentage(a,b){var c=parseInt(b)/parseInt(a)*100;return Math.ceil(c)}function musicPlayerSwitch(a){function b(){replaceClass(e,"on","off"),clearInterval(g),g=setInterval(function(){h+=50,d.style.right=h+"px",f&&(f.style.right=h+"px"),h>=0&&(clearInterval(g),replaceClass(document.getElementById("playerSwitchBtn"),"switch-on","switch-off"),e.title="隐藏播放器")},10)}function c(){return hasClass(e,"on")?!1:(replaceClass(e,"off","on"),clearInterval(g),void(g=setInterval(function(){i+=50,d.style.right="-"+i+"px",f&&(f.style.right="-"+i+"px"),i>=570&&(clearInterval(g),replaceClass(document.getElementById("playerSwitchBtn"),"switch-off","switch-on"),e.title="打开播放器")},10)))}var d=document.getElementById("musicPlayerWrap"),e=document.getElementById("musicPlayerSwitch"),f=document.getElementById("musicList"),g=0,h=-550,i=0;a?"open"===a?b():"close"===a&&c():hasClass(e,"on")?b():hasClass(e,"off")&&c()}function lrcBoxSwitch(){var a=document.getElementById("lyrics"),b=document.getElementById("lrcWrap");hasClass(a,"lyrics-hover")?(a.title="打开歌词",removeClass(a,"lyrics-hover"),addClass(b,"hidden")):(a.title="关闭歌词",addClass(a,"lyrics-hover"),removeClass(b,"hidden"))}function hasClass(a,b){for(var c,d=a.className.split(" "),e=0;e<d.length;e++){if(d[e]===b){c=!0;break}c=!1}return c}function addClass(a,b){hasClass(a,b)||(a.className+=" "+b)}function removeClass(a,b){if(hasClass(a,b))for(var c=a.className.split(" "),d=0;d<c.length;d++)if(c[d]===b){c.splice(d,1),a.className=c.join(" ");break}}function replaceClass(a,b,c){if(hasClass(a,b))for(var d=a.className.split(" "),e=0;e<d.length;e++)if(d[e]===b){d[e]=c,a.className=d.join(" ");break}}function show(a){a.style.display="block"}function hide(a){a.style.display="none"}function fadeIn(a){var b,c=0;a.style.opacity=c,show(a),b=setInterval(function(){c+=.1,a.style.opacity=c,10===c&&clearInterval(b)},30)}function fadeOut(a){var b,c=1;a.style.opacity=c,b=setInterval(function(){c-=.1,a.style.opacity=c,0===c&&clearInterval(b)},30),hide(a)}function coordinate(a){var b,c,d,e=window.event||a;return c=void 0===e.offsetX?getOffset(e).X:e.offsetX,d=void 0===e.offsetY?getOffset(e).Y:e.offsetY,b={coord_X:c,coord_Y:d}}function getOffset(a){var b,c,d,e=a.target;return c=getPageCoord(e),b={X:window.pageXOffset+a.clientX,Y:window.pageYOffset+a.clientY},d={X:b.X-c.X,Y:b.Y-c.Y}}function getPageCoord(a){for(var b={X:0,Y:0};a;)b.X+=a.offsetLeft,b.Y+=a.offsetTop,a=a.offsetParent;return b}!function(){return $("#musicPlayerWrap").length?void XMLHttpData():!1}(),MUSICENGINE.prototype.toPlay=function(a){var b=document.getElementById("play"),c=document.getElementById("pause");""===this.musicPlayer.src&&this.playIndex(0,0),"play"===a&&(this.musicPlayer.play(),this.playbackProgress("play"),hide(b),show(c)),"pause"===a&&(this.musicPlayer.pause(),this.playbackProgress("pause"),show(b),hide(c))},MUSICENGINE.prototype.next=function(){var a=document.getElementById("nowPlayManner").title;this.songPlayMode("next",a)},MUSICENGINE.prototype.prev=function(){var a=document.getElementById("nowPlayManner").title;this.songPlayMode("prev",a)},MUSICENGINE.prototype.volume=function(a){var b=document.getElementById("volumeSizeColor"),c=parseInt(b.style.height);"on"===a&&(b.attributes["data-volume"].nodeValue=this.musicPlayer.volume,b.attributes["data-height"].nodeValue=c,this.musicPlayer.volume=0,volumeIconSwitch("on"),volumeSize(100)),"off"===a&&(this.musicPlayer.volume=b.attributes["data-volume"].nodeValue,volumeIconSwitch("off"),volumeSize(b.attributes["data-height"].nodeValue))},MUSICENGINE.prototype.volumeControlStrip=function(a){this.musicPlayer.volume=a,volumeIconSwitch(a>0?"off":"on")},function(){if(!$("#musicPlayerWrap").length)return!1;var a=document.getElementById("nowVolume"),b=document.getElementById("nowMute"),c=document.getElementById("volumeControl");a.onmouseover=function(){show(c)},b.onmouseover=function(){show(c)},c.onmouseout=function(a){var b=a||window.event;if(b){if(c.contains(b.relatedTarget||b.toElement))return!1;hide(c)}}}(),MUSICENGINE.prototype.playbackProgress=function(a){var b,c,d,e=document.getElementById("progressRateColor"),f=0;"play"===a&&(d=setInterval(function(){var a=document.getElementById("musicEngine");b=timeAll(),c=currentTime(),lrcMove(b,c),songPlaybackTime(b,c),f=c/b*262,e.style.width=f+"px",a.ended&&(clearInterval(d),e.style.width=0,"单曲循环"===document.getElementById("nowPlayManner").title?(a.currentTime=0,a.play()):document.getElementById("next").click())},1e3)),"pause"===a&&clearInterval(d)},MUSICENGINE.prototype.songProgressAdjust=function(a){this.musicPlayer.currentTime=a,lrcAtuoMove(a)},MUSICENGINE.prototype.albumLists=function(){innerMusicList();var a=document.getElementById("musicList"),b=document.getElementById("albumLists"),c=document.getElementById("listWrap"),d=document.getElementById("listName"),e=document.getElementById("cutoverList");"打开专辑列表"===b.title?(closeList(),removeClass(a,"hidden"),c.className="list-wrap album",d.innerHTML="专辑列表",e.innerHTML="查看全部歌曲",e.className="cutover-list",addClass(b,"album-lists-hover"),b.title="关闭专辑列表",this.formatAlbumLists()):"关闭专辑列表"===b.title&&closeList()},MUSICENGINE.prototype.formatAlbumLists=function(){for(var a=this.song,b=document.getElementById("listWrap"),c=a.songData.length,d="",e=0;c>e;e++)d+='<li class="s-l">',d+='<img src="'+a.songData[e].albumCoverMax+'" class="album-cover">',d+='<span class="album-name" title="'+a.songData[e].albumName+'"><span class="speaker"></span><span class="s-a">'+a.songData[e].albumName+"</span></span>",d+='<div class="album-cover-hover hidden">',d+='<div class="mask" title="双击打开"></div>',d+='<span class="album-song-num" title="'+a.songData[e].albumSong.length+'首歌曲">'+a.songData[e].albumSong.length+"</span>",d+='<div class="play-btn" title="播放专辑：'+a.songData[e].albumName+'"><div class="play-icon"></div>播放专辑</div>',d+="</div>",d+="</li>";b.innerHTML=d;for(var f=0;f<b.getElementsByTagName("li").length;f++){var g=b.getElementsByTagName("li")[f];g.onmouseover=function(){show(this.childNodes[2])},g.onmouseout=function(a){var b=a||window.event;if(b){if(g.contains(b.relatedTarget||b.toElement))return!1;hide(this.childNodes[2])}},g.ondblclick=function(){formatInAlbumLists(a,this.childNodes[1].childNodes[1].innerHTML)}}currentlyPlayingSong()},MUSICENGINE.prototype.formatAllSongLists=function(){for(var a,b=this.song,c=document.getElementById("listWrap"),d=document.getElementById("cutoverList"),e=b.songData.length,f="",g=0;e>g;g++){a=b.songData[g].albumSong.length;for(var h=0;a>h;h++)f+='<li class="s-l">',f+='<span class="s-name" title="'+b.songData[g].albumSong[h].musicName+'">'+b.songData[g].albumSong[h].musicName+"</span>",f+='<span class="s-album" title="'+b.songData[g].albumName+'">'+b.songData[g].albumName+"</span>",f+='<span class="s-time">'+b.songData[g].albumSong[h].musicTime+"</span>",f+='<div name="addFavorites" class="add-favorites hidden" title="喜欢"></div>',f+="</li>"}c.className="list-wrap song",c.attributes["data-temp"].nodeValue="0",d.innerHTML="返回",d.className="cutover-list",c.innerHTML=f,currentlyPlayingSong()},MUSICENGINE.prototype.updatePlaylist=function(){var a=document.getElementById("listWrap"),b=this.song,c=b.songData[this.albumIndex].albumSong.length,d="";if(hasClass(a,"song")&&"1"===a.attributes["data-temp"].nodeValue){for(var e=0;c>e;e++)d+='<li class="s-l">',d+='<span class="s-name" title="'+b.songData[this.albumIndex].albumSong[e].musicName+'">'+b.songData[this.albumIndex].albumSong[e].musicName+"</span>",d+='<span class="s-album" title="'+b.songData[this.albumIndex].albumName+'">'+b.songData[this.albumIndex].albumName+"</span>",d+='<span class="s-time">'+b.songData[this.albumIndex].albumSong[e].musicTime+"</span>",d+='<div name="addFavorites" class="add-favorites hidden" title="喜欢"></div>',d+="</li>";a.innerHTML=d}},MUSICENGINE.prototype.songPlayMode=function(a,b){var c,d,e=this.albumIndex+1,f=this.songIndex+1,g=this.song.songData[this.albumIndex].albumSong.length,h=(this.song.songNum,this.song.songData.length);if("列表循环"===b&&("next"===a&&(f===g?e===h&&f===g?(d=1,c=1):(d=e+1,c=1):(d=e,c=f+1)),"prev"===a&&(1===f?1===e&&1===f?(d=h,c=this.song.songData[h-1].albumSong.length):(d=e-1,c=this.song.songData[this.albumIndex-1].albumSong.length):(d=e,c=f-1))),"随机播放"===b){var i=parseInt(h*Math.random()),j=parseInt(this.song.songData[i].albumSong.length*Math.random());d=i+1,c=j+1}if("顺序播放"===b||"单曲循环"===b){if("next"===a)if(f===g){if(e===h&&f===g)return playerInitialization(),!1;d=e+1,c=1}else d=e,c=f+1;"prev"===a&&(1===f?1===e&&1===f?playerInitialization():(d=e-1,c=this.song.songData[this.albumIndex-1].albumSong.length):(d=e,c=f-1))}this.playIndex(d-1,c-1)},MUSICENGINE.prototype.muiscIndexAndAlbumIndex=function(a){for(var b=this.song,c=b.songData.length,d=a.childNodes[0].innerHTML,e=a.childNodes[1].innerHTML,f={},g=0;c>g;g++)if(e===b.songData[g].albumName){f.albumIndex=g;for(var h=0;h<b.songData[g].albumSong.length;h++)if(d===b.songData[g].albumSong[h].musicName){f.songIndex=h;break}break}return f},MUSICENGINE.prototype.playIndex=function(a,b){var c=document.getElementById("albumFrontCover"),d=document.getElementById("musicName"),e=document.getElementById("musicSinger"),f=document.getElementById("albumName"),g=document.getElementById("loadLrc"),h=document.getElementById("playTime"),i=document.getElementById("surplusTime"),j=document.getElementById("progressRateColor"),k=this.song;this.albumIndex=a,this.songIndex=b,show(g),h.innerHTML="0:00",i.innerHTML="-0:00",j.style.width="0",this.musicPlayer.src=k.songData[a].albumSong[b].musicLink,c.src=k.songData[a].albumSong[b].albumCoverMin||"images/album.png",d.innerHTML=k.songData[a].albumSong[b].musicName,d.title=d.innerHTML,e.innerHTML=k.songData[a].albumSong[b].musicSinger,e.title=e.innerHTML,f.innerHTML=k.songData[a].albumName,f.title=f.innerHTML,this.toPlay("play"),this.processingLyrics(k.songData[a].albumSong[b].lyricsLink),this.updatePlaylist(),currentlyPlayingSong()},function(){if(!$("#musicPlayerWrap").length)return!1;{var a=document.getElementById("nowPlayManner"),b=document.getElementById("playMannerControl");document.getElementById("orderPlay"),document.getElementById("shufflePlay"),document.getElementById("singleCycle"),document.getElementById("listCycle")}a.onmouseover=function(){show(b)},b.onmouseout=function(a){var c=a||window.event;if(c){if(b.contains(c.relatedTarget||c.toElement))return!1;hide(b)}},b.onclick=function(a){var b=a?a:window.event;PlayModeIconChange(document.getElementById(b.target.id))}}(),MUSICENGINE.prototype.processingLyrics=function(a){function b(b){""===a?d.innerHTML='<div class="no-lrc">暂无歌词</div>':(e=null,window.XMLHttpRequest?e=new XMLHttpRequest:window.ActiveXObject&&(e=new ActiveXObject("Microsoft.XMLHTTP")),null!=e?(e.onreadystatechange=c,e.open("get",b,!0),e.send(null)):alert("您的浏览器不支持 XMLHTTP"))}function c(){if(4===e.readyState)if(0===e.status||200===e.status){f=e.responseText.replace(/\[\d\d:\d\d.\d\d]/g,""),i=f.split("\n"),i[0].replace(/\[\w\w\:(.*?)\]/g,function(){g=arguments[1]||"暂无"}),i[1].replace(/\[\w\w\:(.*?)\]/g,function(){h=arguments[1]||"暂无"}),k+='<p class="lrc-line" data-timeLine="0"><span class="mr15">歌曲：'+g+"</span>歌手："+h+"</p>",i.splice(0,4),e.responseText.replace(/\[(\d*):(\d*)([\.|\:]\d*)\]/g,function(){var a=0|arguments[1],b=0|arguments[2],c=60*a+b;j.push(c)});for(var a=0;a<j.length;a++)k+='<p class="lrc-line" data-timeLine="'+j[a]+'">'+i[a]+"</p>";d.innerHTML=k}else alert("获取歌词出错，请刷新浏览器")}var d=document.getElementById("lrcBox");d.style.marginTop=0;var e,f,g,h,i=[],j=[],k="";b(a)};
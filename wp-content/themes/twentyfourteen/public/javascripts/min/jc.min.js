var _IE=function(){for(var a=3,b=document.createElement("div"),c=b.getElementsByTagName("i");b.innerHTML="<!--[if gt IE "+ ++a+"]><i></i><![endif]-->",c[0];);return a>4?a:!1}();_IE&&9>_IE&&($("div,section,nav").not("#progress").remove(),$("body").prepend('<div class="bie8"><div class="wrap"><p class="tips">您使用的ie浏览器及版本太OUT了!, SO看到的只是这...</p><p class="info">最佳推荐<a href="http://dlsw.baidu.com/sw-search-sp/gaosu/2014_03_26_17/bind1/14744/ChromeStandaloneSetup33.0.1750.154_14744_BDdl.exe">Google Chrome</a>, 在<a href="http://dlsw.baidu.com/sw-search-sp/soft/6f/11508/Opera_20.0.1387.91_Setup.1397118343.exe" >Opera</a>, <a href="http://dlsw.baidu.com/sw-search-sp/soft/51/11843/Firefox-setup28.0.0.5186.1395192905.exe">Firefox</a>, Safari上也可以有较好体验。</p><p class="info"><a href="http://dlsw.baidu.com/sw-search-sp/gaosu/2014_03_26_17/bind1/14744/ChromeStandaloneSetup33.0.1750.154_14744_BDdl.exe">点击下载</a></p><p class="info">或者 访问 <a href="http://www.joecora.com/?cat=10">其它页面</a></p><p class="ver">友情提示：您当前的浏览器是： ie '+_IE+"</p></div></div>")),$(document).ajaxSend(function(){$("#progress").removeClass("done"),pcsBar(0,0)}).ajaxStart(function(){pcsBar(0,70)}).ajaxSuccess(function(){pcsBar(70,100)}),function(b){var c={$headerTitle:b("#jc-header"),$menu:b("#menu"),$bclk:b("#cnNav"),$ltConAll:b("#ltbg, #conList"),$leftBg:b("#ltbg"),$ltCon:b("#conList"),$article:b("#article"),$imgWrap:b("#imgWrap"),$imgGL:b("#imgGL"),$imgGlList:b("#imgGlList"),$showMode:b("#showMode"),$returnGL:b("#returnGL"),$aboutCon:b(".about-con"),$aboutMore:b(".about-more"),$aboutMusic:b(".about-music"),$player:b("#Player"),$loading:b("<span  class='fa fa-spinner fa-spin'></span>"),$failing:b("<span class='error'><i class='fa fa-info-circle'></i>获取文章信息失败</span>"),$overing:b("<span class='suceess'><i class='fa fa-check-square'></i>加载数据完毕</span>"),index:0,bgs:[{src:"/wp-content/gallery/beach/img_9172-1.jpg",fade:2e3},{src:"/wp-content/gallery/park/img_9116-1.jpg",fade:2e3},{src:"/wp-content/gallery/beach/img_9162-1.jpg",fade:2e3},{src:"/wp-content/gallery/park/img_9150-1.jpg",fade:2e3},{src:"/wp-content/gallery/beach/img_9163-1.jpg",fade:2e3},{src:"/wp-content/gallery/park/img_9157-1.jpg",fade:2e3}],init:function(){c.PatternSet.initPattern(),this.$headerTitle.find("h2 a").lettering(),c.getAjaxPostData(5),c.VegasSet(),c.PageUISet()},PageUISet:function(){function a(){B.find("ul.post-wrapper").height()-B.scrollTop()<450&&w.getAjaxPostData(5)}function d(){var a=b(this),c=a[0].href,d=c.match(/\d+/);return H.setRoute("/article/"+d),w.$aboutCon.hide(),!1}function e(a){var c=a.match(/\d+/),d=h(c),e=E.find('a[href="'+a+'"]').data("art-comment");e?(f(),w.$article.find(".article-con .jc-art").empty().append(e,d),g()):b.ajax({url:a,context:F,beforeSend:function(){f()}}).done(function(c){var e=b(b.parseHTML(c)).find("#content").find("article.post, nav.post-navigation");g(),this.find(".article-con .jc-art").append(e,d);E.find('a[href="'+a+'"]').data("art-comment",e);return!1}).fail(function(){alert("调用发生错误！")})}function f(){var a=F.find(".article-con");a.find(".jc-art").empty(),a.find(".jc-art").append(w.$loading),F.find(".close").off(),F.find(".size").off(),w.PatternSet.openItem(),w.PatternSet.$mbPattern.children().promise().done(function(){F.show()}).done(function(){w.PatternSet.$mbPattern.hide()})}function g(){F.find(".close").click(i),F.find(".size").click(function(){b(this).hasClass("enlarge")?n(F):b(this).hasClass("mini")&&o(F)}),m(F.find(".jc-art")),F.find(".fa-spinner").remove()}function h(a){var c=b("<div />");return c.attr({"data-thread-key":a,"data-url":"http://www.joecora.com"}),DUOSHUO.EmbedThread(c[0]),c}function i(){F.hide(),w.PatternSet.$mbPattern.show(),w.PatternSet.disperse(),H.setRoute("/")}function j(a,b){A.is(":visible")&&!a.is(":visible")&&(a.slideDown().siblings().slideUp(),b&&b())}function k(){j(B)}function l(){j(D,function(){var a=b("#vedio");a.find("#ds-thread").length||a.prepend(h(195))})}function m(a){a.find(".comments-link a").attr({href:function(){return"#"+b(this).attr("href").match(/[a-z]*$/)}}),a.find("a.comment-reply-link").each(function(){b(this).attr("href",b(this).attr("href").substring(1))}),a.find("#ds-thread").prepend("<a name='comments' />"),a.off(),a.on("click",".entry-meta a",function(){var a=b(this);if(a.parent().hasClass("entry-date"))return this.href="",!1;if(a.hasClass("url")){var c=this.href;return e(c),!1}}),a.on("click","h1.entry-title a",function(){var a=this.href;return e(a),!1})}function n(a){a.find(".article-bg").css({backgroundColor:"#000",Zindex:"100"}),a.animate({width:"65%",height:"80%"},200,function(){a.animate({"margin-top":-a.height()/2,top:"50%",left:"011x0px",right:"120px!important"})}),a.addClass("lg-con").find(".enlarge").removeClass("enlarge").addClass("mini").find(".fa-search-plus").removeClass("fa-search-plus").addClass("fa-search-minus"),v=!0}function o(a){a.find(".article-bg").css({backgroundColor:"#000",opacity:"0.8",Zindex:"100"}),a.animate({width:"400px",height:"400px"},200,function(){a.animate({"margin-top":-a.height()/2,top:"50%",left:"011x0px",right:"120px!important"})}),a.removeClass("lg-con").find(".mini").removeClass("mini").addClass("enlarge").find(".fa-search-minus").removeClass("fa-search-minus").addClass("fa-search-plus"),v=!1}function p(){C.is(":visible")?r():j(C,function(){w.$imgGL.find(".view").length||q()})}function q(){b.ajax({url:"?page_id=213",context:w.$imgGL,dataType:"html",beforeSend:function(){w.$imgGL.append(w.$loading)}}).done(function(a){$htmlDoc=b(b.parseHTML(a));var c=s($htmlDoc);this.append(c),this.find(".fa-spinner").remove(),this.on("click",".view a",function(){var a=b(this).parent().data("gl");return H.setRoute("/gallery/"+a),!1}),w.$returnGL.click(function(){H.setRoute("/gallery")}),w.$showMode.on("click","button",function(){b(this).addClass("active").siblings().removeClass("active")})}).fail(function(){alert("调用发生错误！")})}function r(){w.$imgGL.show(),w.$imgGL.next().hide()}function s(a){var c=a.find(".ngg-albumoverview"),d=c.find(".ngg-albumtitle"),e=c.find(".ngg-thumbnail a img"),f=c.find(".ngg-description"),g=c.find(".ngg-thumbnail a");galleryData=[],galleryItem=[];for(var h=0;h<d.length;h++)!function(){var a={galleryThumbSrc:e[h].src,galleryTitle:b(d[h]).text(),galleryDescription:b(f[h]).text(),galleryLinks:g[h].href};galleryData.push(a)}();var i="<% _.each(galleryData, function(item) { %> <div class='view view-tenth' data-gl='<%= item.galleryTitle %>'><a href='<%= item.galleryLinks %>'><img src='<%= item.galleryThumbSrc %>' /><div class='mask'><h2><%= item.galleryTitle %></h2><p><%= item.galleryDescription %></p></div></a></div> <% }); %>",j=_.template(i,galleryData);return j}function t(a,c){w.$imgGL.hide(),w.$imgGL.next().show();var d=w.$imgGlList.find(".ngg-galleryoverview");d.hide(),d.hasClass(c)?w.$imgGlList.find("."+c).show():b.ajax({url:a.href,dataType:"html",context:w.$imgGlList,beforeSend:function(){this.append(w.$loading)}}).done(function(c){var d=b(b.parseHTML(c)).find(".ngg-galleryoverview");this.append(d.addClass(b(a).parent().data("gl"))),this.find(".fa-spinner").remove(),u()})}function u(){return b(".ngg-galleryoverview").off(),b(".ngg-galleryoverview").on("click",".ngg-gallery-thumbnail-box a",function(){if(modeClass=w.$showMode.find("button.active"),modeClass.hasClass("show-bgs")){var a=this.href,b={src:a,fade:2e3};c.loadImage(a,function(){c.triggerBgPic(b)})}else modeClass.hasClass("show-grid")||modeClass.hasClass("show-book")||alert("请选择浏览模式");return!1}),!1}var v,w=this,x=0,y=w.$menu,z=w.$player,A=w.$ltCon,B=A.find("#post"),C=A.find("#img"),D=A.find("#vedio"),E=A.find(".post-wrapper"),F=w.$article,G={"/article":k,"/article/:id":[function(a){e("http://www.joecora.com/?p="+a)}],"/gallery":p,"/gallery/:id":[function(a){C.is(":visible")||p(),t(w.$imgWrap.find('div[data-gl="'+a+'"]').find("a")[0],a)}],"/words":l,"/user":[function(){b("#user").find(".lwa").toggle()}],"/music":[function(){w.$aboutMusic.trigger("click")}]},H=new Router(G);H.init(),b("#expando").hover(function(){w.$leftBg.css({opacity:.8,filter:"alpha(opacity=60)"})},function(){w.$leftBg.css({opacity:.5,filter:"alpha(opacity=50)"})}),z.media({url:"/wp-content/themes/twentyfourteen/public/data/music.json",autoPlay:!0,timeout:8e3,initCircle:"random",autoHide:!1}),w.$leftBg.click(function(){x++,x%2?A.hide().parents().find(".ltbg").animate({width:"10px"},200,function(){b(this).addClass("shrink")}):w.$leftBg.removeClass("shrink").animate({width:"100%"},{duration:200,queue:!0,specialEasing:{width:"linear",height:"easeOutBounce"},complete:function(){A.show()}})});var I=_.throttle(a,500);B.scroll(I),B.on("click","ul li a",d),D.on("click",".ds-thread-title a",d),b("#user").on("click","h3",function(){var a=b("#user").find(".lwa");a.toggle(),a.is(":visible")&&H.setRoute("/user")}),y.on("click",".nav span.mn",function(){return b(this).hasClass("postNav")?(H.setRoute("/article"),!1):(b(this).hasClass("imgNav")?H.setRoute("/gallery"):b(this).hasClass("vedNav")?H.setRoute("/words"):b(this).hasClass("timeNav"),w.$article.is(":visible")&&i(),!1)}),w.$aboutMore.click(function(){w.$aboutCon.is(":visible")?w.$aboutCon.slideUp():w.$aboutCon.slideDown(),z.hasClass("show")&&z.media("togglePlayer",z),w.$article.is(":hidden")||i(),b(this).hasClass("active")?(b(this).removeClass("active"),b(this).find("i").removeClass("fa-arrow-circle-o-down").addClass("fa-arrow-circle-o-up")):(b(this).addClass("active"),b(this).find("i").removeClass("fa-arrow-circle-o-up").addClass("fa-arrow-circle-o-down")),w.$aboutCon.find("li:first-child").addClass("active").find(" .about-item-desc").show().animate({width:"200px",margin:"10px"},200),w.$aboutCon.find("li:first-child").siblings().find(" .about-item-desc").removeClass("active").animate({width:"0",margin:"0"},200),w.$aboutCon.off(),w.$aboutCon.on("click","li a",function(){var a=b(this);return a.parent().hasClass("active")?!1:(a.parent().siblings().find(" .about-item-desc").animate({width:"0",margin:"0"},200),a.parent().addClass("active").siblings().removeClass("active"),a.next().show().animate({width:"200px",margin:"10px"},200),void 0)})}),w.$aboutMusic.click(function(){w.$aboutCon.hide(),z.hasClass("hide")&&H.setRoute("/music"),z.media("togglePlayer",z)})},getAjaxPostData:function(a){var c=this,d=c.$ltCon.find(".post-wrapper");b.ajax({url:"?feed=rss2",dataType:"xml",beforeSend:function(){d.append(c.$loading)}}).done(function(e){var f=b(e).find("channel item"),g=f.length;if(a*c.index>g)d.find(c.$loading,c.$overing).remove();else{var h=a*(c.index+1)>g?_.last(_.first(f,a*(c.index+1)),g-a):_.last(_.first(f,a*(c.index+1)),a),i=[];b(h).each(function(){var a=b('<li><a href="'+b(this).find("link").text()+'">'+b(this).find("title").text()+'</a><span class="post-date">'+b(this).find("description").text()+"</span></li>");i.push(a)}),d.find(c.$loading,c.$overing).remove().end().append(i)}c.index++}).fail(function(){d.find(loading,overing).remove().end().append(c.$failing)})},triggerBgPic:function(a){var d=c.bgs;_.contains(_.pluck(d,"src"),a.src)?b.vegas("jump",_.indexOf(d,a-1)):(d.push(a),d.length>15&&d.shift(),b.vegas("jump",d.length-1))},fullOrThumb:function(a){var b,c,d;return-1===a.indexOf("/thumbs/")?(b=a.lastIndexOf("/")+1,c=a.substring(0,b)+"thumbs/thumbs_"+a.substring(b)):(b=a.indexOf("/thumbs/"),d=a.substring(0,b)+"/"+a.substring(b+7)),c||d},loadImage:function(a,c){b("#progress").removeClass("done"),pcsBar(0,60);var d=new Image;return d.src=a,d.complete?(pcsBar(60,100),void c.call(d)):void(d.onload=function(){pcsBar(60,100),c.call(d)})},VegasSet:function(){var a=this,d=a.$bclk.find(".cn-nav-prev"),e=a.$bclk.find(".cn-nav-next");b.vegas("slideshow",{backgrounds:a.bgs,delay:6e3,preload:!0})("overlay",{src:"/wp-content/themes/twentyfourteen/public/images/overlays/mask.png",opacity:.8}),b("body").on("vegaswalk",function(b,f,g){var h=a.bgs[g?g-1:a.bgs.length-1].src,i=g==a.bgs.length-1?a.bgs[0].src:a.bgs[g+1].src;d.find("div").css("background-image","url("+c.fullOrThumb(h)+")"),e.find("div").css("background-image","url("+c.fullOrThumb(i)+")")}),this.$bclk.on("click",".cn-nav-item",function(a){return b(".vegas-background").stop(),-1!==a.currentTarget.className.indexOf("cn-nav-prev")&&b.vegas("previous"),-1!==a.currentTarget.className.indexOf("cn-nav-next")&&b.vegas("next"),!1})},PatternSet:{$mbPattern:b("#mb_pattern"),initPattern:function(){for(var c=0;16>c;++c)this.showItem("50px","50px"),$el=b("<div>").css(param),$el.css("transform","rotate("+a+"deg)"),$el.appendTo(this.$mbPattern)},disperse:function(){pt=this,this.$mbPattern.children().each(function(){pt.showItem("50px","50px"),$el=b(this),$el.css("transform","rotate("+a+"deg)"),$el.animate(param,1e3)})},showItem:function(b,c){var e=.2,g=Math.floor(171*Math.random())+30,h=Math.floor(496*Math.random())+5,i=Math.floor(255*Math.random()),j=Math.floor(255*Math.random()),k=Math.floor(255*Math.random());a=Math.floor(101*Math.random())-50,d=1.5+.5*Math.random(),f=5*Math.random(),param={width:b,height:c,opacity:e,top:g+"px",right:h+"px",backgroundColor:"rgb("+i+","+j+","+k+")",borderRadius:d+"em",webkitFilter:"blur("+f+"px)"}},openItem:function(){this.$mbPattern.children().each(function(a){var c=b(this),d={width:"100px",height:"100px",top:188+100*Math.floor(a/4),right:100*(a%4),opacity:.2,backgroundColor:"rgb(0,0,0)",borderRadius:"0",webkitFilter:"blur(0px)"};c.css("transform","rotate(0deg)"),c.animate(d,1e3,"swing")})}}};c.init()}(jQuery,document);
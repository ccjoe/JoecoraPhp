!function(b){var c={$menu:b("#menu"),$bclick:b("#cnNav"),$bl:b("#cnNav").find(".cn-nav-prev"),$br:b("#cnNav").find(".cn-nav-next"),$leftConAll:b("#ltbg, #conList"),$leftBg:b("#ltbg"),$leftCon:b("#conList"),$postList:b("#conList").find("#post"),$article:b("#article"),$img:b("#conList").find("#img"),$vedioList:b("#conList").find("#vedio"),$postListCon:b("#conList").find(".post-wrapper"),$imgWrap:b("#imgWarp"),$imgGL:b("#imgGL"),$imgGlList:b("#imgGlList"),$showMode:b("#showMode"),$returnGL:b("#returnGL"),$aboutCon:b(".about-con"),$headerTitle:b("#jc-header"),$loading:b("<span  class='fa fa-spinner fa-spin'></span>"),$ok:b('<span><i class="fa fa-ok"></i>发表成功，待审核后可见</span>'),$tips:b('<span><i class="fa fa-hand-o-right"></i>麻烦将*号项填写正确</span>'),$wrong:b('<i class="fa fa-plus"></i>'),$failing:b("<span class='error'><i class='fa fa-info-circle'></i>提交数据失败,原因为提交内容一致或太过频繁</span>"),$overing:b("<span class='suceess'><i class='fa fa-check-square'></i>加载数据完毕</span>"),index:0,bgs:[{src:"/wp-content/gallery/beach/img_9172-1.jpg",fade:4e3},{src:"/wp-content/gallery/park/img_9116-1.jpg",fade:4e3},{src:"/wp-content/gallery/beach/img_9162-1.jpg",fade:4e3},{src:"/wp-content/gallery/park/img_9150-1.jpg",fade:4e3},{src:"/wp-content/gallery/beach/img_9163-1.jpg",fade:4e3},{src:"/wp-content/gallery/park/img_9157-1.jpg",fade:4e3}],init:function(){this.$headerTitle.find("h2 a").lettering(),c.getAjaxPostData(5),c.PatternSet.initPattern(),c.VegasSet(),c.PageUISet()},PageUISet:function(){function a(a){b.ajax({url:a,context:m.$article,beforeSend:function(){b(this).find(".article-con").append(m.$loading),b(this).find(".close").off(),b(this).find(".size").off();var a=b(this);b("#content")&&b("#content").remove(),m.PatternSet.openItem(),m.PatternSet.$mbPattern.children().promise().done(function(){a.show()}).done(function(){m.PatternSet.$mbPattern.hide()})}}).done(function(a){var c=b(b.parseHTML(a)).find("#content"),h=b(this);return h.find(".article-con").append(c),h.find(".close").click(d),h.find(".size").click(function(){b(this).hasClass("enlarge")?f(h):b(this).hasClass("mini")&&g(h)}),e(b("#content")),m.ajaxComment(),m.$article.find(".fa-spinner").remove(),!1}).fail(function(){alert("调用发生错误！")})}function d(){m.$article.hide(),m.PatternSet.$mbPattern.show(),m.PatternSet.disperse()}function e(c){c.find(".comments-link a").attr({href:"#comments"}),c.find("a.comment-reply-link").each(function(){b(this).attr("href",b(this).attr("href").substring(1))}),c.on("click",".entry-meta a",function(){var c=b(this);if(c.parent().hasClass("entry-date"))return this.href="",!1;if(c.hasClass("url")){var d=this.href;return a(d),!1}}),c.on("click","h1.entry-title a",function(){var b=this.href;return a(b),!1})}function f(a){a.find(".article-bg").css({backgroundColor:"#000",Zindex:"100"}),a.animate({width:"65%",height:"80%"},200,function(){a.animate({"margin-top":-a.height()/2,top:"50%",left:"011x0px",right:"120px!important"})}),a.addClass("lg-con").find(".enlarge").removeClass("enlarge").addClass("mini"),l=!0}function g(a){a.find(".article-bg").css({backgroundColor:"#000",opacity:"0.8",Zindex:"100"}),a.animate({width:"400px",height:"400px"},200,function(){a.animate({"margin-top":-a.height()/2,top:"50%",left:"011x0px",right:"120px!important"})}),a.removeClass("lg-con").find(".mini").removeClass("mini").addClass("enlarge"),l=!1}function h(){b.ajax({url:"?page_id=213",context:m.$imgGL,dataType:"html",beforeSend:function(){m.$imgGL.append(m.$loading)}}).done(function(a){var c=this;$htmlDoc=b(b.parseHTML(a));var d=i($htmlDoc);this.append(d),this.find(".fa-spinner").remove(),this.on("click",".view a",function(){c.hide(),c.next().show();var a=b(this).parent().data("gl"),d=m.$imgGlList.find(".ngg-galleryoverview");return d.hide(),d.hasClass(a)?m.$imgGlList.find("."+a).show():j(this),!1}),m.$returnGL.click(function(){c.show(),c.next().hide()}),m.$showMode.on("click","button",function(){b(this).addClass("active").siblings().removeClass("active")})}).fail(function(){alert("调用发生错误！")})}function i(a){var c=a.find(".ngg-albumoverview"),d=c.find(".ngg-albumtitle"),e=c.find(".ngg-thumbnail a img"),f=c.find(".ngg-description"),g=c.find(".ngg-thumbnail a");galleryData=[],galleryItem=[];for(var h=0;h<d.length;h++)!function(){var a={galleryThumbSrc:e[h].src,galleryTitle:b(d[h]).text(),galleryDescription:b(f[h]).text(),galleryLinks:g[h].href};galleryData.push(a)}();var i="<% _.each(galleryData, function(item) { %> <div class='view view-tenth' data-gl='label-<%= item.galleryTitle %>'><a href='<%= item.galleryLinks %>'><img src='<%= item.galleryThumbSrc %>' /><div class='mask'><h2><%= item.galleryTitle %></h2><p><%= item.galleryDescription %></p></div></a></div> <% }); %>",j=_.template(i,galleryData);return j}function j(a){b.ajax({url:a.href,dataType:"html",context:m.$imgGlList,beforeSend:function(){this.append(m.$loading)}}).done(function(c){var d=b(b.parseHTML(c)).find(".ngg-galleryoverview");this.append(d.addClass(b(a).parent().data("gl"))),this.find(".fa-spinner").remove(),k()})}function k(){return b(".ngg-galleryoverview").off(),b(".ngg-galleryoverview").on("click",".ngg-gallery-thumbnail-box a",function(){if(modeClass=m.$showMode.find("button.active"),modeClass.hasClass("show-bgs")){var a=this.href,d={src:a,fade:4e3};c.loadImage(a,function(){c.triggerBgPic(d)})}else if(modeClass.hasClass("show-grid")){getCurrentGalleryName=b(".showGalleryName:visible").text(),$clonehtmlDoc=b(htmlDoc).clone();var e=$clonehtmlDoc.find(".dirlabel-"+getCurrentGalleryName).find(".image-mergin").addClass(getCurrentGalleryName+"-gridlabel"),f=b("<script type='text/javascript' src='/javascripts/MergingImageBoxes.js'></script>");b("body").find("."+getCurrentGalleryName+"-gridlabel")[0]||(b("body").append(e).append(f),b.vegas("pause"),b(".radial-gradient").css("background-color","rgba(0,0,0,0.6)"),m.$leftBg.trigger("click"));var g=b("#im_close");g.bind("click",function(){b(".image-mergin").remove(),b.vegas("pause"),b(".radial-gradient").css("background-color","rgba(0,0,0,0)"),m.$leftBg.trigger("click")})}else modeClass.hasClass("show-book")||alert("请选择浏览模式");return!1}),!1}var l,m=this,n=0;b(document).ajaxSend(function(){pcsBar(0,0)}).ajaxStart(function(){pcsBar(0,30)}).ajaxSuccess(function(){pcsBar(30,90)}).ajaxComplete(function(){pcsBar(90,100)}).ajaxStop(function(){}).ajaxError(function(){pcsBar(0,0)}),screen.width<600&&b("#musicPlayerWrap").remove(),b("#expando").hover(function(){m.$leftBg.css({opacity:.6,filter:"alpha(opacity=60)"})},function(){m.$leftBg.css({opacity:.1,filter:"alpha(opacity=10)"})}),m.$leftBg.click(function(){n++,n%2?m.$leftCon.hide().parents().find(".ltbg").animate({width:"10px"},200,function(){b(this).addClass("shrink")}):m.$leftBg.removeClass("shrink").animate({width:"100%"},{duration:200,queue:!0,specialEasing:{width:"linear",height:"easeOutBounce"},complete:function(){m.$leftCon.show()}})}),m.$postList.scroll(function(){b(this).find("ul.post-wrapper").height()-b(this).scrollTop()<450&&_.throttle(function(){m.getAjaxPostData(5)},200)}),this.$postList.on("click","ul li a",function(){var c=b(this)[0].href;return a(c),m.$aboutCon.hide(),!1}),b("#user").on("click","h3",function(){b(".lwa-default").toggle()}),m.$menu.on("click",".nav span.mn",function(){return b(this).hasClass("postNav")?m.$leftCon.is(":visible")&&m.$postList.is(":visible")===!1&&m.$postList.slideDown().siblings().slideUp():b(this).hasClass("imgNav")?m.$leftCon.is(":visible")&&m.$img.is(":visible")===!1&&(m.$img.slideDown().siblings().slideUp(),m.$imgGL.find(".view").length||h()):b(this).hasClass("vedNav")?leftCon.is(":visible")&&vedioList.is(":visible")===!1&&b("#conList").find("section").slideUp().end().find(".vedio-list").slideDown():b(this).hasClass("timeNav")&&(b.vegas("pause"),b(".vegas-background").hide()),!1}),b(".about-more").click(function(){m.$aboutCon.slideToggle(),b("#musicPlayerWrap").length&&musicPlayerSwitch("close"),m.$article.is(":hidden")||d(),b(this).hasClass("active")?(b(this).removeClass("active"),b(this).find("i").removeClass("fa-arrow-circle-o-down").addClass("fa-arrow-circle-o-up")):(b(this).addClass("active"),b(this).find("i").removeClass("fa-arrow-circle-o-up").addClass("fa-arrow-circle-o-down")),m.$aboutCon.find("li:first-child").addClass("active").find(" .about-item-desc").show().animate({width:"200px",margin:"10px"},200),m.$aboutCon.find("li:first-child").siblings().find(" .about-item-desc").removeClass("active").animate({width:"0",margin:"0"},200),m.$aboutCon.off(),m.$aboutCon.on("click","li a",function(){var a=b(this);return a.parent().hasClass("active")?!1:(a.parent().siblings().find(" .about-item-desc").animate({width:"0",margin:"0"},200),a.parent().addClass("active").siblings().removeClass("active"),a.next().show().animate({width:"200px",margin:"10px"},200),void 0)})}),b(".about-music").click(function(){m.$aboutCon.hide(),b("#musicPlayerWrap").length&&musicPlayerSwitch()}),b("#musicPlayerSwitch").on("click",function(){m.$aboutCon.hide(),musicPlayerSwitch()})},VegasSet:function(){var a=this;b.vegas("slideshow",{backgrounds:a.bgs,delay:8e3,preload:!0})("overlay",{src:"/wp-content/themes/twentyfourteen/public/images/overlays/mask.png",opacity:.8}),b("body").on("vegaswalk",function(b,d,e){var f=a.bgs[e?e-1:a.bgs.length-1].src,g=e==a.bgs.length-1?a.bgs[0].src:a.bgs[e+1].src;a.$bl.find("div").css("background-image","url("+c.fullOrThumb(f)+")"),a.$br.find("div").css("background-image","url("+c.fullOrThumb(g)+")")}),this.$bclick.on("click",".cn-nav-item",function(a){return b(".vegas-background").stop(),-1!==a.currentTarget.className.indexOf("cn-nav-prev")&&b.vegas("previous"),-1!==a.currentTarget.className.indexOf("cn-nav-next")&&b.vegas("next"),!1})},getAjaxPostData:function(a){var c=this;b.ajax({url:"?feed=rss2",dataType:"xml",beforeSend:function(){c.$postListCon.append(c.$loading)}}).done(function(d){var e=b(d).find("channel item"),f=e.length;if(a*c.index>f)c.$postListCon.find(c.$loading,c.$overing).remove();else{var g=a*(c.index+1)>f?_.last(_.first(e,a*(c.index+1)),f-a):_.last(_.first(e,a*(c.index+1)),a),h=[];b(g).each(function(){var a=b('<li><a href="'+b(this).find("link").text()+'">'+b(this).find("title").text()+'</a><span class="post-date">'+b(this).find("description").text()+"</span></li>");h.push(a)}),c.$postListCon.find(c.$loading,c.$overing).remove().end().append(h)}c.index++}).fail(function(){c.$postListCon.find(loading,overing).remove().end().append(c.$failing)})},PatternSet:{$mbPattern:b("#mb_pattern"),initPattern:function(){for(var c=0;16>c;++c)this.showItem("initial","initial"),$el=b("<div>").css(param),$el.css("transform","rotate("+a+"deg)"),$el.appendTo(this.$mbPattern)},disperse:function(){pt=this,this.$mbPattern.children().each(function(){pt.showItem("50px","50px"),$el=b(this),$el.css("transform","rotate("+a+"deg)"),$el.animate(param,1e3)})},showItem:function(b,c){var e=.2,g=Math.floor(171*Math.random())+30,h=Math.floor(696*Math.random())+5,i=Math.floor(255*Math.random()),j=Math.floor(255*Math.random()),k=Math.floor(255*Math.random());a=Math.floor(101*Math.random())-50,d=1.5+.5*Math.random(),f=5*Math.random(),param={width:b,height:c,opacity:e,top:g+"px",right:h+"px",backgroundColor:"rgb("+i+","+j+","+k+")",borderRadius:d+"em",webkitFilter:"blur("+f+"px)"}},openItem:function(){this.$mbPattern.children().each(function(a){var c=b(this),d={width:"100px",height:"100px",top:188+100*Math.floor(a/4),right:120+100*(a%4),opacity:.2,backgroundColor:"rgb(0,0,0)",borderRadius:"0",webkitFilter:"blur(0px)"};c.css("transform","rotate(0deg)"),c.animate(d,1e3,"swing")})}},ajaxComment:function(){b("#submit").click(function(){var a=b("#commentform"),d={author:a.find("#author").val(),email:a.find("#email").val(),url:a.find("#url").val(),comment:a.find("#comment").val(),submit:a.find("#submit").val(),comment_post_ID:a.find("#comment_post_ID").val(),comment_parent:a.find("#comment_parent").val()};for(var e in d)if(""===d[e]&&"url"!==e)return"comment_post_ID"!==b("#submit").next()[0].id&&b("#submit").next().remove(),b("#submit").after(c.$tips),!1;return b.ajax({url:window.location.href,type:"POST",data:a.serialize()+"&action=ajax_comment",beforeSend:function(){"comment_post_ID"!==b("#submit").next()[0].id&&b("#submit").next().remove(),b("#submit").after(c.$loading)}}).done(function(a){a.success&&(b("#submit").next().remove(),b("#submit").after(c.$ok))}).fail(function(){"comment_post_ID"!==b("#submit").next()[0].id&&b("#submit").next().remove(),b("#submit").after(c.$failing)}),!1})},triggerBgPic:function(a){var d=c.bgs;_.contains(_.pluck(d,"src"),a.src)?b.vegas("jump",_.indexOf(d,a-1)):(d.push(a),d.length>15&&d.shift(),b.vegas("jump",d.length-1))},fullOrThumb:function(a){var b,c,d;return-1===a.indexOf("/thumbs/")?(b=a.lastIndexOf("/")+1,c=a.substring(0,b)+"thumbs/thumbs_"+a.substring(b)):(b=a.indexOf("/thumbs/"),d=a.substring(0,b)+"/"+a.substring(b+7)),c||d},loadImage:function(a,b){var c=new Image;return c.src=a,c.complete?void b.call(c):void(c.onload=function(){b.call(c)})}};c.init()}(jQuery,document);